<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Working with Predictable Network Interface Names and netplan | mzfr's Blog</title><meta name=keywords content><meta name=description content="Recently I was working on making a new Virtual machine for Vulnhub(it&rsquo;s in beta right now) and one of the issues I came across was the problem of not having any interface except the loopback (lo) in the newly created VM. Now setting a new interface is easy but What I wanted was to set Dynamic DHCP IP so whenever someone starts the VM it&rsquo;s assigned an IP using which they can attack the box."><meta name=author content><link rel=canonical href=https://blog.mzfr.me/posts/2019-11-16-interface-names/><link href=https://blog.mzfr.me/assets/css/stylesheet.min.9b41f1fca0ecd98165aaa98ef85e6717a95f6621f6190ac064cd8c42a8334c28.css integrity="sha256-m0Hx/KDs2YFlqqmO+F5nF6lfZiH2GQrAZM2MQqgzTCg=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.mzfr.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.mzfr.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mzfr.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.mzfr.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.mzfr.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.1"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/solarized-dark.min.css integrity="sha512-H+WY7zsI0kQwkbYE+yp/9vg/UzpiyuKERzpxOaGwKCc7iFoNpi0h3mQ4GpZMO9lDaVzc1xjD3e6g/UMuUlOicg==" crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-147356794-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Working with Predictable Network Interface Names and netplan"><meta property="og:description" content="Recently I was working on making a new Virtual machine for Vulnhub(it&rsquo;s in beta right now) and one of the issues I came across was the problem of not having any interface except the loopback (lo) in the newly created VM. Now setting a new interface is easy but What I wanted was to set Dynamic DHCP IP so whenever someone starts the VM it&rsquo;s assigned an IP using which they can attack the box."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mzfr.me/posts/2019-11-16-interface-names/"><meta property="article:published_time" content="2019-11-16T00:00:00+00:00"><meta property="article:modified_time" content="2019-11-16T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Working with Predictable Network Interface Names and netplan"><meta name=twitter:description content="Recently I was working on making a new Virtual machine for Vulnhub(it&rsquo;s in beta right now) and one of the issues I came across was the problem of not having any interface except the loopback (lo) in the newly created VM. Now setting a new interface is easy but What I wanted was to set Dynamic DHCP IP so whenever someone starts the VM it&rsquo;s assigned an IP using which they can attack the box."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Working with Predictable Network Interface Names and netplan","name":"Working with Predictable Network Interface Names and netplan","description":"Recently I was working on making a new Virtual machine for Vulnhub(it\u0026amp;rsquo;s in beta right now) and one of the issues I came across was the problem of not having any interface …","keywords":[],"articleBody":"Recently I was working on making a new Virtual machine for Vulnhub(it’s in beta right now) and one of the issues I came across was the problem of not having any interface except the loopback (lo) in the newly created VM. Now setting a new interface is easy but What I wanted was to set Dynamic DHCP IP so whenever someone starts the VM it’s assigned an IP using which they can attack the box.\nNow the problem here is that recent versions of Linux uses a new network interface naming scheme called “Predictable Network Interface Names”. This mean your interface name might not be eth0, it maybe different on diffrent machine. This is done for lot of various reasons like having a stable interface names during reboots or during kernels/drivers updates etc. But this can sometime cause issue when you move a VM from VirtualBox to VMware player/workstation, the issue would be that VMware/vbox might not pick up the IP meaning the VM will run but no IP will be assign to it so you won’t be able to access that VM from outside.\n@DCAU7 has done some investigation on this and found out that:\n  VMware Player can have issues with Bridged Networks. This is detailed in this video\n  The interface name changed and this directly affected the ability to pick up a DHCP address due to differences between the name and what appears in /etc/network/interface file.\n  He came up with a solution for this but that solution doesn’t work on Ubuntu 17.10 or hight because of netplan. Netplan is a new command-line network configuration utility introduced in Ubuntu 17.10 to manage and configure network settings easily in Ubuntu systems. It allows you to configure a network interface using YAML configuration. So only editing the /interface file wouldn’t change the interface name. We will have to make a netcfg.yaml file in /etc/netplan/ along with some other files to fix this problem and get an interface named eth0 permanently.\nSolution The permanent solution for this would involve editing the /etc/network/interface and also making a /etc/netplan/01-netcfg.yaml file. Also we’ll have to edit the /etc/default/grub.\n Edit grub - nano /etc/default/grub  Edit the line GRUB_CMDLINE_LINUX=\"\" to GRUB_CMDLINE_LINUX=\"net.ifnames=0 biosdevname=0\"\nThen apply those changes by running: grub-mkconfig -o /boot/grub/grub.cfg\n Edit interface - nano /etc/network/interfaces  Make sure it look like\nSo most probably you might have to add\n#The primary network interfaces auto-hotplug eth0 iface eth0 inet dhcp  Make netplan config - nano /etc/netplan/01-netcfg.yaml  It’s highly likely that this file might not exists on your system and you might have to make it. One thing to keep in mind is no need to name the file 01-netcfg the important part is the .yaml extension, netplan reads all the .yaml file under /etc/netplan/. so file could be named ubuntu-going-crazy.yaml, what matter is the content of the file and that extension.\nadd the following to your yaml config file:\nnetwork: version: 2 renderer: networkd ethernets: eth0: dhcp4: yes dhcp6: yes Here under ethernets I have used eth0 because that’s the interface name I’ve used in /etc/network/interfaces and also that’s the name I want :-)\nNow apply these changes by running: sudo netplan apply.\nOnce all these things are done, reboot the VM and you will have a new interface named eth0, you can check this by running ifconfig -a or ip addr\n This was one of the most important part of making a VM and I am thankful to @DCAU7 because he helped me in setting this up.\nHope this will help you in someway or the other.\n Thanks for reading, Feedback is always appreciated.\nYou can follow me on @0xmzfr.\n","wordCount":"603","inLanguage":"en","datePublished":"2019-11-16T00:00:00Z","dateModified":"2019-11-16T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.mzfr.me/posts/2019-11-16-interface-names/"},"publisher":{"@type":"Organization","name":"mzfr's Blog","logo":{"@type":"ImageObject","url":"https://blog.mzfr.me/favicon.ico"}}}</script></head><body><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://blog.mzfr.me accesskey=h>mzfr's Blog</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://blog.mzfr.me/><span>Home</span></a></li><li><a href=https://blog.mzfr.me/posts/><span>Blog</span></a></li><li><a href=https://blog.mzfr.me/about/><span>About</span></a></li><li><a href=https://blog.mzfr.me/ctf/><span>CTF</span></a></li><li><a href=https://mzfr.gitbook.io/notes/><span>Notes</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Working with Predictable Network Interface Names and netplan</h1><div class=post-meta>November 16, 2019&nbsp;·&nbsp;3 min</div></header><div class=post-content><p>Recently I was working on making a new Virtual machine for Vulnhub(it&rsquo;s in beta right now) and one of the issues I came across was the problem of not having any interface except the loopback (<code>lo</code>) in the newly created VM. Now setting a new interface is easy but What I wanted was to set Dynamic DHCP IP so whenever someone starts the VM it&rsquo;s assigned an IP using which they can attack the box.</p><p>Now the problem here is that recent versions of Linux uses a new network interface naming scheme called &ldquo;<a href=https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/>Predictable Network Interface Names</a>&rdquo;. This mean your interface name might not be <code>eth0</code>, it maybe different on diffrent machine. This is done for lot of various reasons like having a stable interface names during reboots or during kernels/drivers updates etc. But this can sometime cause issue when you move a VM from VirtualBox to VMware player/workstation, the issue would be that VMware/vbox might not pick up the IP meaning the VM will run but no IP will be assign to it so you won&rsquo;t be able to access that VM from outside.</p><p><a href=https://twitter.com/DCAU7>@DCAU7</a> has done some investigation on this and found out that:</p><ol><li><p>VMware Player can have issues with Bridged Networks. This is detailed in this <a href="https://www.youtube.com/watch?v=AsSDXznIhGc">video</a></p></li><li><p>The interface name changed and this directly affected the ability to pick up a DHCP address due to differences between the name and what appears in <code>/etc/network/interface</code> file.</p></li></ol><p>He came up with a solution for this but that solution doesn&rsquo;t work on Ubuntu 17.10 or hight because of <code>netplan</code>. Netplan is a new command-line network configuration utility introduced in Ubuntu 17.10 to manage and configure network settings easily in Ubuntu systems. It allows you to configure a network interface using YAML configuration. So only editing the <code>/interface</code> file wouldn&rsquo;t change the interface name. We will have to make a <code>netcfg.yaml</code> file in <code>/etc/netplan/</code> along with some other files to fix this problem and get an interface named <code>eth0</code> permanently.</p><h2 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h2><p>The permanent solution for this would involve editing the <code>/etc/network/interface</code> and also making a <code>/etc/netplan/01-netcfg.yaml</code> file. Also we&rsquo;ll have to edit the <code>/etc/default/grub</code>.</p><ul><li>Edit grub - <code>nano /etc/default/grub</code></li></ul><p>Edit the line <code>GRUB_CMDLINE_LINUX=""</code> to <code>GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"</code></p><p><img src=/images/grub.png alt></p><p>Then apply those changes by running: <code>grub-mkconfig -o /boot/grub/grub.cfg</code></p><ul><li>Edit interface - <code>nano /etc/network/interfaces</code></li></ul><p>Make sure it look like</p><p><img src=/images/interface.png alt></p><p>So most probably you might have to add</p><pre><code>#The primary network interfaces
auto-hotplug eth0
iface eth0 inet dhcp
</code></pre><ul><li>Make netplan config - <code>nano /etc/netplan/01-netcfg.yaml</code></li></ul><p>It&rsquo;s highly likely that this file might not exists on your system and you might have to make it. One thing to keep in mind is <strong>no need to name the file 01-netcfg</strong> the important part is the <strong>.yaml</strong> extension, netplan reads all the <strong>.yaml</strong> file under <strong>/etc/netplan/</strong>. so file could be named <strong>ubuntu-going-crazy.yaml</strong>, what matter is the content of the file and that extension.</p><p>add the following to your yaml config file:</p><pre><code>network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      dhcp4: yes
      dhcp6: yes
</code></pre><p>Here under <code>ethernets</code> I have used <code>eth0</code> because that&rsquo;s the interface name I&rsquo;ve used in <code>/etc/network/interfaces</code> and also that&rsquo;s the name I want :-)</p><p>Now apply these changes by running: <code>sudo netplan apply</code>.</p><p>Once all these things are done, reboot the VM and you will have a new interface named <code>eth0</code>, you can check this by running <code>ifconfig -a</code> or <code>ip addr</code></p><hr><p>This was one of the most important part of making a VM and I am thankful to <a href=https://twitter.com/DCAU7>@DCAU7</a> because he helped me in setting this up.</p><p>Hope this will help you in someway or the other.</p><hr><p>Thanks for reading, Feedback is always appreciated.</p><p>You can follow me on <a href=https://twitter.com/0xmzfr>@0xmzfr</a>.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2020 <a href=https://blog.mzfr.me>mzfr's Blog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><button class=top-link id=top-link type=button aria-label="go to top" title="Go to Top" accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button>
<script defer src=https://blog.mzfr.me/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};mybutton.onclick=function(){document.body.scrollTop=0;document.documentElement.scrollTop=0;window.location.hash=''}
function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>