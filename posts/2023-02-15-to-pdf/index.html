<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Charts in a PDF, Please | mzfr's blog</title><meta name=keywords content><meta name=description content="Generating PDF from HTML containing pie charts from chartjs"><meta name=author content><link rel=canonical href=https://blog.mzfr.me/posts/2023-02-15-to-pdf/><link crossorigin=anonymous href=/assets/css/stylesheet.58451d8f813b8ca6dd4aba8121b595b6e8f0a4077ab901e0e07a009b8270bc9c.css integrity="sha256-WEUdj4E7jKbdSrqBIbWVtujwpAd6uQHg4HoAm4JwvJw=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.mzfr.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.mzfr.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mzfr.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.mzfr.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.mzfr.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/monokai-sublime.min.css integrity="sha512-/l4iViNMhxR5MhSlak3Yw/L/7qUBifVy7MpLjeJTc8BPMRFbGplGN0xqufCDwhSdxSnVgy+e/OYsNnU75K3yyQ==" crossorigin=anonymous referrerpolicy=no-referrer><script async src=https://analytics.mzfr.me/script.js data-website-id=10e5d04b-13bb-4110-99b2-8c72f8854043></script><meta property="og:title" content="Charts in a PDF, Please"><meta property="og:description" content="Generating PDF from HTML containing pie charts from chartjs"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mzfr.me/posts/2023-02-15-to-pdf/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-15T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Charts in a PDF, Please"><meta name=twitter:description content="Generating PDF from HTML containing pie charts from chartjs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.mzfr.me/posts/"},{"@type":"ListItem","position":3,"name":"Charts in a PDF, Please","item":"https://blog.mzfr.me/posts/2023-02-15-to-pdf/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Charts in a PDF, Please","name":"Charts in a PDF, Please","description":"Generating PDF from HTML containing pie charts from chartjs","keywords":[],"articleBody":" ‚ö†Ô∏è It is possible that you might read this post and realize that there are much easier ways to solve this problem. If that is the case please let me know.\nProblem Description I wanted to add a ‚Äúprint to PDF‚Äù button on a dashboard which is supposed to show teachers an update about their student‚Äôs work.\nThe dashboard shows various tables with information about all the things that the student has answered/asked/submitted etc. The application is built using the Django framework with very minimalist CSS \u0026 JS.\nTechnical Description As I said the application is built using the Django framework with really minimalistic JS. And some chunk of that JS is written to generate graphs on a teacher‚Äôs dashboard, using chart.js library.\nBelow is a heavily redacted version of the teachers_dashboard.html template which is being used to show stuff to teachers.\n{% extends 'header.html' %} {% load static %} {% block extra_head_content %} {{ block.super }} // chart.js script link hosted internally {% endblock %} \u003cbody\u003e // Lot of code for tables and other bootstrap elements \u003ca class=\"btn btn-primary\" href=\"{% url 'generateReport' %}\" target=\"_blank\" role=\"button\"\u003eGenerate Report\u003c/a\u003e \u003c/body\u003e // Script responsible for generating doughnut charts using chart.js and the context data being passed by Django views The roundabout When the ticket for the above-mentioned problem got assigned to me I was pretty confident I can finish the implementation in around 20-30 minutes. But boy was I wrong.\nThe very first google search suggested that I use the library weasyprint, so I did another google search ‚Äúweasyprint Django‚Äù and took help (yes I copied the code) from this article. Once everything was done, I clicked on the newly placed Generate Report button on the dashboard and got a PDF. But it was missing all the doughnut charts which I could clearly see on the dashboard.\nSo it was time for another google search, and after some time I finally landed on this issue(https://github.com/Kozea/WeasyPrint/issues/817) when I noticed it was closed I took a breath of relief because obviously someone else had this issue and people must have already suggested a solution for it which lead to the closure of that issue. But when I read this comment(https://github.com/Kozea/WeasyPrint/issues/817#issuecomment-470079749) my heart sank, life seemed meaningless. I was asking questions like, what is even the point of having open source libraries if I can‚Äôt just simply use them without having to worry about ‚Äústuff‚Äù (/s)?\nAnyways by the time I was done reading that thread, I could already see two alternatives suggested by one of the maintainers of the weasyprint library.\nTaken from https://github.com/Kozea/WeasyPrint/issues/817#issuecomment-470084446\nThe first alternative is suggesting to use Phantomjs. But the moment you open the website you‚Äôll notice something along the lines of:\nImportant: PhantomJS development is suspended until further notice (more details). When I read the above line I felt that it might not be the best option to use something which isn‚Äôt active development (I am going to regret making this decision later). So I started looking into the second alternative(https://github.com/Kozea/WeasyPrint/issues/23). But the thread also wasn‚Äôt much help. So at that time, I realized that weasyprint was not the right way to do it.\nThen after a bit more looking around I found another library named xhtlm2pdf. When I started to read the documentation I felt this must be it because they even had a separate section on how to use that library with Django (Using xhtml2pdf in Django). So I simply copied the code from their documentation and again waited for my beautiful PDF to come out. But I was again disappointed because this PDF was not only missing charts but also basic bootstrap CSS.\nThe reason for the missing CSS was that my link_callback function wasn‚Äôt working properly and for missing graphs were because I didn‚Äôt use something called canvas in the template being used for generating the report. So after making the necessary changes I was once again full of hopes, which were shattered a few seconds later. I really spent a good amount of time trying to figure out why the graphs were not showing up and that everything was the way it should be. I tried searching old/open issues on the repository to see if this library also has something similar to what weasyprint had, but I didn‚Äôt find anything which might tell me why I was having this issue. So about 3-4 hours later I was back to square one.\nNow that both the heavily used libraries were out of option I thought of trying to use matplotlib to generate the graphs as images and put those images on the dashboard. The issue with that was the default images being generated by that library had a white background and even with the dark background it was easily noticeable that someone has added weird images on the dashboard or in the report. So I had to drop this idea as well.\nSolution ‚ö†Ô∏è Disclaimer ‚ö†Ô∏è I am not really good with JS or CSS so if the things you are about to read make your skin crawl or something, I apologize in advance**\nIn the end, I decided to use wkhtmltopdf. I did some manual testing with it and the only thing it didn‚Äôt do was show the chart in the PDF. Other than that I felt like the CSS rendering quality of this tool was higher than xhtml2pdf or weasyprint.\nBut still, there were two three issues with wkhtmltopdf\nwkhtmltopdf isn‚Äôt some python library but a tool written in C++ and you basically get a binary of this tool to use it on CLI. It doesn‚Äôt process JS in the given template just like weasyprint. oh and also the repository was recently(Jan 2, 2023) archived - read project status to know why? (https://wkhtmltopdf.org/status.html) Problem 3 For this, I simply decided that the repository was recently archived and is still going to be functional for quite some time. So in simple terms, I decided to ignore the idea that I am putting an unmaintained tool in my new project (something I could have done with PhantomJS ü§¶‚Äç‚ôÇÔ∏è).\nProblem 1 It isn‚Äôt exactly a library but there is a library called django-wkhtmltopdf which can be used along with a binary in any Django project. So this problem was also solved easily.\nProblem 2 This was basically the whole crux of the problem. This is the same issue I faced with weasyprint and xhtml2pdf(maybe). I needed a way to same those chart.js doughnuts as images, then add those images to a template, and then pass that template along with another context(data to fill in tables/headers, etc) to wkhtmltopdf tool.\nSo here is what I did:\nIn the teachers_dashboard.html template I added the following JS: $(document).ready(function () { // Lot of other function call to show all the dashboard stuff charts.image = myChart2.toBase64Image(); let csrftoken = getCookie('csrftoken'); fetch('{% url \"locallysavegraphs\" %}', { method: 'POST', headers: { 'Accept': 'application/json, text/plain, */*', 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken }, body: JSON.stringify({ chart: charts.image }) }).then(res =\u003e res.json()) .then(res =\u003e console.log(res)); // This function was taken from Django documentation function getCookie(name) { var cookieValue = null; if (document.cookie \u0026\u0026 document.cookie !== '') { var cookies = document.cookie.split(';'); for (var i = 0; i \u003c cookies.length; i++) { var cookie = cookies[i].trim(); if (cookie.substring(0, name.length + 1) === (name + '=')) { cookieValue = decodeURIComponent(cookie.substring(name.length + 1)); break; } } } return cookieValue; } }); When the teacher‚Äôs dashboard is loaded and chartjs generates all it charts we are taking the base64 of those images and then performing a POST request to another django endpoint(/locallysavegraphs).\nThat view is responsible for saving those base64 data into images and storing those images locally.\nI added the following line in the template which was going to be passed to wkhtmltopdf \u003cimg src=\"\" style=\"width: 30%\" I basically hardcoded the path to those images.\nI wrote the following view for generating the PDF: from wkhtmltopdf.views import PDFTemplateResponse class PdfGeneration(View): def get(self, request): get_context = FUNCTION_WHICH_GIVE_DATA() response = PDFTemplateResponse( request=request, template=\"HTML_TEMPLATE_FOR_MAKING_PDF.html\", filename=\"PRODUCT_DASHBOARD.pdf\", context=get_context, show_content_in_browser=True, cmd_options={\"enable-local-file-access\": True}, ) return response The PDFTemplateResponse is provided by the django-wkhtmltopdf library. And to that function, we just pass the context, template, and some other options that wkhtmltopdf would take.\nWith this implementation, everything worked like a charm. I was initially expecting things to be a bit slow but I really didn‚Äôt notice any performance issue either on testing or on production.\nWhile writing this post I realized that I could have done everything the same up until step 2 and then instead of using wkhtmltopdf I could have passed the same information to weasyprint. So what I mean to say is that I could have saved quite a lot of time if I had decided to make things work with weasyprint without easily giving up on it. Wow! this sounds like life advice.\nAnyways, if you know better ways to print PDF from Django view(with content as well as charts) please let me know. Thanks for reading üëã\n","wordCount":"1494","inLanguage":"en","datePublished":"2023-02-15T00:00:00Z","dateModified":"2023-02-15T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.mzfr.me/posts/2023-02-15-to-pdf/"},"publisher":{"@type":"Organization","name":"mzfr's blog","logo":{"@type":"ImageObject","url":"https://blog.mzfr.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.mzfr.me accesskey=h title="mzfr's blog (Alt + H)">mzfr's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.mzfr.me/ title=Home><span>Home</span></a></li><li><a href=https://blog.mzfr.me/about/ title=About><span>About</span></a></li><li><a href=https://wiki.mzfr.me title=Notes><span>Notes</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://blog.mzfr.me/ctf/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Charts in a PDF, Please</h1><div class=post-meta><span title='2023-02-15 00:00:00 +0000 UTC'>February 15, 2023</span>&nbsp;¬∑&nbsp;8 min</div></header><div class=post-content><blockquote><p>‚ö†Ô∏è It is possible that you might read this post and realize that there are much easier ways to solve this problem. If that is the case please let me know.</p></blockquote><h1 id=problem-description>Problem Description<a hidden class=anchor aria-hidden=true href=#problem-description>#</a></h1><p>I wanted to add a &ldquo;print to PDF&rdquo; button on a dashboard which is supposed to show teachers an update about their student&rsquo;s work.</p><p>The dashboard shows various tables with information about all the things that the student has answered/asked/submitted etc. The application is built using the Django framework with very minimalist CSS & JS.</p><h2 id=technical-description>Technical Description<a hidden class=anchor aria-hidden=true href=#technical-description>#</a></h2><p>As I said the application is built using the Django framework with really minimalistic JS. And some chunk of that JS is written to generate graphs on a teacher&rsquo;s dashboard, using <a href=https://www.chartjs.org/>chart.js</a> library.</p><p>Below is a heavily redacted version of the <code>teachers_dashboard.html</code> template which is being used to show stuff to teachers.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>{% extends &#39;header.html&#39; %}
</span></span><span style=display:flex><span>{% load static %}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{% block extra_head_content %}
</span></span><span style=display:flex><span>{{ block.super }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// chart.js script link hosted internally
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{% endblock %}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#e06c75>body</span>&gt;
</span></span><span style=display:flex><span>// Lot of code for tables and other bootstrap elements
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#e06c75>a</span> <span style=color:#b3d23c>class</span><span style=color:#c7bf54>=</span><span style=color:#98c379>&#34;btn btn-primary&#34;</span> <span style=color:#b3d23c>href</span><span style=color:#c7bf54>=</span><span style=color:#98c379>&#34;{% url &#39;generateReport&#39; %}&#34;</span> <span style=color:#b3d23c>target</span><span style=color:#c7bf54>=</span><span style=color:#98c379>&#34;_blank&#34;</span> <span style=color:#b3d23c>role</span><span style=color:#c7bf54>=</span><span style=color:#98c379>&#34;button&#34;</span>&gt;Generate Report&lt;/<span style=color:#e06c75>a</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;/<span style=color:#e06c75>body</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// Script responsible for generating doughnut charts using chart.js and the context data being passed by Django views
</span></span></code></pre></div><h1 id=the-roundabout>The roundabout<a hidden class=anchor aria-hidden=true href=#the-roundabout>#</a></h1><p>When the ticket for the above-mentioned problem got assigned to me I was pretty confident I can finish the implementation in around 20-30 minutes. But boy was I wrong.</p><p>The very first google search suggested that I use the library <a href=https://weasyprint.org/>weasyprint</a>, so I did another google search &ldquo;weasyprint Django&rdquo; and took help (yes I copied the code) from this <a href=https://micropyramid.com/blog/generate-pdf-files-from-html-in-django-using-weasyprint/>article</a>. Once everything was done, I clicked on the newly placed <code>Generate Report</code> button on the dashboard and got a PDF. But it was missing all the doughnut charts which I could clearly see on the dashboard.</p><p>So it was time for another google search, and after some time I finally landed on this issue(<a href=https://github.com/Kozea/WeasyPrint/issues/817>https://github.com/Kozea/WeasyPrint/issues/817</a>) when I noticed it was closed I took a breath of relief because obviously someone else had this issue and people must have already suggested a solution for it which lead to the closure of that issue. But when I read this comment(<a href=https://github.com/Kozea/WeasyPrint/issues/817#issuecomment-470079749>https://github.com/Kozea/WeasyPrint/issues/817#issuecomment-470079749</a>) my heart sank, life seemed meaningless. I was asking questions like, what is even the point of having open source libraries if I can&rsquo;t just simply use them without having to worry about &ldquo;stuff&rdquo; (/s)?</p><p>Anyways by the time I was done reading that thread, I could already see two alternatives suggested by one of the maintainers of the weasyprint library.</p><p><img loading=lazy src=/images/alternative_suggest_library.png alt>
<em>Taken from <a href=https://github.com/Kozea/WeasyPrint/issues/817#issuecomment-470084446>https://github.com/Kozea/WeasyPrint/issues/817#issuecomment-470084446</a></em></p><p>The first alternative is suggesting to use <a href=https://phantomjs.org/>Phantomjs</a>. But the moment you open the website you&rsquo;ll notice something along the lines of:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Important: PhantomJS development is suspended until further notice (more details).
</span></span></code></pre></div><p>When I read the above line I felt that it might not be the best option to use something which isn&rsquo;t active development (I am going to regret making this decision later). So I started looking into the second alternative(<a href=https://github.com/Kozea/WeasyPrint/issues/23)>https://github.com/Kozea/WeasyPrint/issues/23)</a>. But the thread also wasn&rsquo;t much help. So at that time, I realized that weasyprint was not the right way to do it.</p><p>Then after a bit more looking around I found another library named <a href=https://github.com/xhtml2pdf/xhtml2pdf>xhtlm2pdf</a>. When I started to read the documentation I felt this must be it because they even had a separate section on how to use that library with Django (<a href=https://xhtml2pdf.readthedocs.io/en/latest/usage.html#using-xhtml2pdf-in-django>Using xhtml2pdf in Django</a>). So I simply copied the code from their documentation and again waited for my beautiful PDF to come out. But I was again disappointed because this PDF was not only missing charts but also basic bootstrap CSS.</p><p>The reason for the missing CSS was that my <code>link_callback</code> function wasn&rsquo;t working properly and for missing graphs were because I didn&rsquo;t use something called <code>canvas</code> in the template being used for generating the report. So after making the necessary changes I was once again full of hopes, which were shattered a few seconds later. I really spent a good amount of time trying to figure out why the graphs were not showing up and that everything was the way it should be. I tried searching old/open issues on the repository to see if this library also has something similar to what weasyprint had, but I didn&rsquo;t find anything which might tell me why I was having this issue. So about 3-4 hours later I was back to square one.</p><p>Now that both the heavily used libraries were out of option I thought of trying to use <a href=https://matplotlib.org/>matplotlib</a> to generate the graphs as images and put those images on the dashboard. The issue with that was the default images being generated by that library had a white background and even with the dark background it was easily noticeable that someone has added weird images on the dashboard or in the report. So I had to drop this idea as well.</p><h1 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h1><blockquote><p>‚ö†Ô∏è Disclaimer ‚ö†Ô∏è I am not really good with JS or CSS so if the things you are about to read make your skin crawl or something, I apologize in advance**</p></blockquote><p>In the end, I decided to use <a href=https://wkhtmltopdf.org/>wkhtmltopdf</a>. I did some manual testing with it and the only thing it didn&rsquo;t do was show the chart in the PDF. Other than that I felt like the CSS rendering quality of this tool was higher than xhtml2pdf or weasyprint.</p><p>But still, there were <del>two</del> three issues with wkhtmltopdf</p><ol><li>wkhtmltopdf isn&rsquo;t some python library but a tool written in C++ and you basically get a binary of this tool to use it on CLI.</li><li>It doesn&rsquo;t process JS in the given template just like weasyprint.</li><li>oh and also the repository was recently(Jan 2, 2023) archived - read project status to know why? (<a href=https://wkhtmltopdf.org/status.html>https://wkhtmltopdf.org/status.html</a>)</li></ol><h3 id=problem-3>Problem 3<a hidden class=anchor aria-hidden=true href=#problem-3>#</a></h3><p>For this, I simply decided that the repository was recently archived and is still going to be functional for quite some time. So in simple terms, I decided to ignore the idea that I am putting an unmaintained tool in my new project (something I could have done with PhantomJS ü§¶‚Äç‚ôÇÔ∏è).</p><h3 id=problem-1>Problem 1<a hidden class=anchor aria-hidden=true href=#problem-1>#</a></h3><p>It isn&rsquo;t exactly a library but there is a library called <a href=https://github.com/incuna/django-wkhtmltopdf>django-wkhtmltopdf</a> which can be used along with a binary in any Django project. So this problem was also solved easily.</p><h3 id=problem-2>Problem 2<a hidden class=anchor aria-hidden=true href=#problem-2>#</a></h3><p>This was basically the whole crux of the problem. This is the same issue I faced with weasyprint and xhtml2pdf(maybe). I needed a way to same those chart.js doughnuts as images, then add those images to a template, and then pass that template along with another context(data to fill in tables/headers, etc) to wkhtmltopdf tool.</p><p>So here is what I did:</p><ol><li>In the <code>teachers_dashboard.html</code> template I added the following JS:</li></ol><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    <span style=color:#c1abea>$</span>(<span style=color:#ef8383>document</span>).<span style=color:#c1abea>ready</span>(<span style=color:#c678dd>function</span> () {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// Lot of other function call to show all the dashboard stuff
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#c1abea>charts</span>.<span style=color:#c1abea>image</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>myChart2</span>.<span style=color:#c1abea>toBase64Image</span>();
</span></span><span style=display:flex><span>    <span style=color:#c678dd>let</span> <span style=color:#c1abea>csrftoken</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>getCookie</span>(<span style=color:#98c379>&#39;csrftoken&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c1abea>fetch</span>(<span style=color:#98c379>&#39;{% url &#34;locallysavegraphs&#34; %}&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#c1abea>method</span><span style=color:#c7bf54>:</span> <span style=color:#98c379>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#c1abea>headers</span><span style=color:#c7bf54>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#98c379>&#39;Accept&#39;</span><span style=color:#c7bf54>:</span> <span style=color:#98c379>&#39;application/json, text/plain, */*&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#98c379>&#39;Content-Type&#39;</span><span style=color:#c7bf54>:</span> <span style=color:#98c379>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#98c379>&#39;X-CSRFToken&#39;</span><span style=color:#c7bf54>:</span> <span style=color:#c1abea>csrftoken</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c1abea>body</span><span style=color:#c7bf54>:</span> <span style=color:#c1abea>JSON</span>.<span style=color:#c1abea>stringify</span>({ <span style=color:#c1abea>chart</span><span style=color:#c7bf54>:</span> <span style=color:#c1abea>charts</span>.<span style=color:#c1abea>image</span> })
</span></span><span style=display:flex><span>    }).<span style=color:#c1abea>then</span>(<span style=color:#c1abea>res</span> =&gt; <span style=color:#c1abea>res</span>.<span style=color:#c1abea>json</span>())
</span></span><span style=display:flex><span>        .<span style=color:#c1abea>then</span>(<span style=color:#c1abea>res</span> =&gt; <span style=color:#c1abea>console</span>.<span style=color:#c1abea>log</span>(<span style=color:#c1abea>res</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// This function was taken from Django documentation
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#c678dd>function</span> <span style=color:#c1abea>getCookie</span>(<span style=color:#c1abea>name</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>var</span> <span style=color:#c1abea>cookieValue</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> (<span style=color:#ef8383>document</span>.<span style=color:#c1abea>cookie</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#ef8383>document</span>.<span style=color:#c1abea>cookie</span> <span style=color:#c7bf54>!==</span> <span style=color:#98c379>&#39;&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#c678dd>var</span> <span style=color:#c1abea>cookies</span> <span style=color:#c7bf54>=</span> <span style=color:#ef8383>document</span>.<span style=color:#c1abea>cookie</span>.<span style=color:#c1abea>split</span>(<span style=color:#98c379>&#39;;&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#c678dd>for</span> (<span style=color:#c678dd>var</span> <span style=color:#c1abea>i</span> <span style=color:#c7bf54>=</span> <span style=color:#d19a66>0</span>; <span style=color:#c1abea>i</span> <span style=color:#c7bf54>&lt;</span> <span style=color:#c1abea>cookies</span>.<span style=color:#c1abea>length</span>; <span style=color:#c1abea>i</span><span style=color:#c7bf54>++</span>) {
</span></span><span style=display:flex><span>                <span style=color:#c678dd>var</span> <span style=color:#c1abea>cookie</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>cookies</span>[<span style=color:#c1abea>i</span>].<span style=color:#c1abea>trim</span>();
</span></span><span style=display:flex><span>                <span style=color:#c678dd>if</span> (<span style=color:#c1abea>cookie</span>.<span style=color:#c1abea>substring</span>(<span style=color:#d19a66>0</span>, <span style=color:#c1abea>name</span>.<span style=color:#c1abea>length</span> <span style=color:#c7bf54>+</span> <span style=color:#d19a66>1</span>) <span style=color:#c7bf54>===</span> (<span style=color:#c1abea>name</span> <span style=color:#c7bf54>+</span> <span style=color:#98c379>&#39;=&#39;</span>)) {
</span></span><span style=display:flex><span>                    <span style=color:#c1abea>cookieValue</span> <span style=color:#c7bf54>=</span> <span style=color:#ef8383>decodeURIComponent</span>(<span style=color:#c1abea>cookie</span>.<span style=color:#c1abea>substring</span>(<span style=color:#c1abea>name</span>.<span style=color:#c1abea>length</span> <span style=color:#c7bf54>+</span> <span style=color:#d19a66>1</span>));
</span></span><span style=display:flex><span>                    <span style=color:#c678dd>break</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#c1abea>cookieValue</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>When the teacher&rsquo;s dashboard is loaded and chartjs generates all it charts we are taking the base64 of those images and then performing a POST request to another django endpoint(<code>/locallysavegraphs</code>).</p><p>That view is responsible for saving those base64 data into images and storing those images locally.</p><ol start=2><li>I added the following line in the template which was going to be passed to wkhtmltopdf</li></ol><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#e06c75>img</span> <span style=color:#b3d23c>src</span><span style=color:#c7bf54>=</span><span style=color:#98c379>&#34;&lt;PATH_TO_THE_SAVED_IMAGES&gt;&#34;</span> <span style=color:#b3d23c>style</span><span style=color:#c7bf54>=</span><span style=color:#98c379>&#34;width: 30%&#34;</span>
</span></span></code></pre></div><p>I basically hardcoded the path to those images.</p><ol start=3><li>I wrote the following view for generating the PDF:</li></ol><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#76a9f9>wkhtmltopdf.views</span> <span style=color:#c678dd>import</span> <span style=color:#c1abea>PDFTemplateResponse</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#76a9f9>PdfGeneration</span>(<span style=color:#c1abea>View</span>):
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#00b1f7>get</span>(<span style=color:#c1abea>self</span>, <span style=color:#c1abea>request</span>):
</span></span><span style=display:flex><span>        <span style=color:#c1abea>get_context</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>FUNCTION_WHICH_GIVE_DATA</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c1abea>response</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>PDFTemplateResponse</span>(
</span></span><span style=display:flex><span>            <span style=color:#c1abea>request</span><span style=color:#c7bf54>=</span><span style=color:#c1abea>request</span>,
</span></span><span style=display:flex><span>            <span style=color:#c1abea>template</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;HTML_TEMPLATE_FOR_MAKING_PDF.html&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#c1abea>filename</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;PRODUCT_DASHBOARD.pdf&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#c1abea>context</span><span style=color:#c7bf54>=</span><span style=color:#c1abea>get_context</span>,
</span></span><span style=display:flex><span>            <span style=color:#c1abea>show_content_in_browser</span><span style=color:#c7bf54>=</span><span style=color:#b756ff;font-weight:700>True</span>,
</span></span><span style=display:flex><span>            <span style=color:#c1abea>cmd_options</span><span style=color:#c7bf54>=</span>{<span style=color:#63c381>&#34;enable-local-file-access&#34;</span>: <span style=color:#b756ff;font-weight:700>True</span>},
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#c1abea>response</span>
</span></span></code></pre></div><p>The <code>PDFTemplateResponse</code> is provided by the django-wkhtmltopdf library. And to that function, we just pass the context, template, and some other options that wkhtmltopdf would take.</p><hr><p>With this implementation, everything worked like a charm. I was initially expecting things to be a bit slow but I really didn&rsquo;t notice any performance issue either on testing or on production.</p><hr><p>While writing this post I realized that I could have done everything the same up until step 2 and then instead of using wkhtmltopdf I could have passed the same information to weasyprint. So what I mean to say is that I could have saved quite a lot of time if I had decided to make things work with weasyprint without easily giving up on it. Wow! this sounds like life advice.</p><p>Anyways, if you know better ways to print PDF from Django view(with content as well as charts) please let me know. Thanks for reading üëã</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://blog.mzfr.me/posts/2022-12-31-year-in-review/><span class=title>Next ¬ª</span><br><span>Year In Review-2022</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.mzfr.me>mzfr's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>