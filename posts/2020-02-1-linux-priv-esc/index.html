<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux Privilege escalation | mzfr's Blog</title><meta name=keywords content><meta name=description content="If you do all the HackTheBox, Vulnhub etc VM you will understand the feeling of getting a reverse shell on the machine but we know that you&rsquo;re far from home. Finding the right vector for escalating your privileges can be a pain in the ass. I&rsquo;m going to share some of the methods I completely depends upon for finding those vulnerable vector that helps to escalate privilege on Linux system."><meta name=author content><link rel=canonical href=https://blog.mzfr.me/posts/2020-02-1-linux-priv-esc/><link href=https://blog.mzfr.me/assets/css/stylesheet.min.9b41f1fca0ecd98165aaa98ef85e6717a95f6621f6190ac064cd8c42a8334c28.css integrity="sha256-m0Hx/KDs2YFlqqmO+F5nF6lfZiH2GQrAZM2MQqgzTCg=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.mzfr.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.mzfr.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mzfr.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.mzfr.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.mzfr.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.1"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/solarized-dark.min.css integrity="sha512-H+WY7zsI0kQwkbYE+yp/9vg/UzpiyuKERzpxOaGwKCc7iFoNpi0h3mQ4GpZMO9lDaVzc1xjD3e6g/UMuUlOicg==" crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-147356794-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Linux Privilege escalation"><meta property="og:description" content="If you do all the HackTheBox, Vulnhub etc VM you will understand the feeling of getting a reverse shell on the machine but we know that you&rsquo;re far from home. Finding the right vector for escalating your privileges can be a pain in the ass. I&rsquo;m going to share some of the methods I completely depends upon for finding those vulnerable vector that helps to escalate privilege on Linux system."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mzfr.me/posts/2020-02-1-linux-priv-esc/"><meta property="article:published_time" content="2020-02-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-02-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux Privilege escalation"><meta name=twitter:description content="If you do all the HackTheBox, Vulnhub etc VM you will understand the feeling of getting a reverse shell on the machine but we know that you&rsquo;re far from home. Finding the right vector for escalating your privileges can be a pain in the ass. I&rsquo;m going to share some of the methods I completely depends upon for finding those vulnerable vector that helps to escalate privilege on Linux system."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux Privilege escalation","name":"Linux Privilege escalation","description":"If you do all the HackTheBox, Vulnhub etc VM you will understand the feeling of getting a reverse shell on the machine but we know that you\u0026amp;rsquo;re far from home. Finding the â€¦","keywords":[],"articleBody":"If you do all the HackTheBox, Vulnhub etc VM you will understand the feeling of getting a reverse shell on the machine but we know that youâ€™re far from home. Finding the right vector for escalating your privileges can be a pain in the ass. Iâ€™m going to share some of the methods I completely depends upon for finding those vulnerable vector that helps to escalate privilege on Linux system.\nEnumeration scripts What I use?\nThere are lots of enumeration script that people use and they can be very helpful but can also be overwhelming at the same time. Example, LinEnum I think this must be the most used enumeration script among CTF players that is because it shows all the necessary information about the system like network information, running process, binaries with capabilities etc.\nI personally donâ€™t like to use LinEnum because of the following reason:\n  The output is overwhelming which is can be very difficult to go through or maybe you can say I am just lazy to go through ðŸ˜œ.\n  Itâ€™s too plain i.e the best thing would have been to colorize some important things.\n  Those are the reason I use jalesc, this is very similar to LinEnum but the main point of using this was because it highlights all the things that might be considered important like if there is some unusally SUID or if the kernel is too old that would be highlighted in the output which would be easy to checkout. And for personal use Iâ€™ve edited out the script to only those things that are very important to me.\nHow does enumeration script helps\nEnum scripts just gives you all the information at once so say if there was some binary which is set SUID you can obviously use it to escalate privileges. So Enum scripts are the definitely the way to start your enumeration once on the system.\nYou can run a python -m http.server on your machine and then wget your enumeration script into the /tmp folder, chmod it and run it.\nSearching GTFObins Sometimes you find some suids or some sudo rights for specific binaries which can be used to escalate privileges easily for that you can directly search those binaries on gtfobins. If you like to search it from within your terminal you can use a tool called gtfo. Whatever you use searching binaries on gtfobins is very important to easy your escalation process.\nSudo rights From past few months even before running enumeration scripts I check for sudo rights of the user I am currently logged in and this is the must. To check those run\nsudo -l The output may look like\nUser mzfr may run the following commands on mzfr: (root) NOPASSWD: /bin/nmap This mean that current user mzfr can run nmap as root without password. In lot of machines sudo right is the way to escalate and mostly in machines that have horizontal and vertical privilege escalation.\nWhat is horizontal and vertical privilege escalation?\nWhen you escalate from one user to another. Example, say if a machine have a user mzfr and you got shell as www-data so when you escalate privileges from www-data to mzfr that is horizontal privilege escalation and when you escalate privilege from mzfr to root thats vertical privilege escalation\nSUIDs These are the files that have special kind of power that power is that whenever we run those files they will be executed as root. These files are mostly reported by enumeration scripts but if you want to separately search them then you can do that by running:\nfind / -perm -u=s -type f 2/dev/null Using pspy Sometime when you donâ€™t find anything with enumeration script or as SUID you have to snoop on process running in the background that is when pspy comes into play.\nYou can just transfer the binary to the machine and then run it just by running:\n$ ./pspy and then wait for sometime to see if it capture some running process. Itâ€™s mostly useful to see if there is a cronjob running or if there is some kind of custom script setup.\nUsing Find command Lots of time itâ€™s very helpful to use this command because it can help you find files or directory to which a current user have access to.\nExample: Say you get a shell as www-data now after looking for suids, sudo rights and cron jobs you didnâ€™t find anything then best would be to run any of the following command:\nfind / -type f -user www-data 2/dev/null and/or\nfind / -type d -user www-data 2/dev/null These commands just find any file or directory which gives read/write access to user www-data and redirects all the errors to /dev/null.\nThis is helpful because you might encounter scenarios where the author of the machine wants you to read some file containing SSH keys or passwords or some other information needed to move ahead.\n These 3-4 steps will help you like 90% of the times obviously there are special occasions when escalating privileges can either be super hard either because the method is too CTFy (like running strings command on an image) or is way too realistic like docker sharing file/folder with root access.\n Thanks for reading, Feedback is always appreciated.\nYou can follow me on @0xmzfr.\n","wordCount":"884","inLanguage":"en","datePublished":"2020-02-01T00:00:00Z","dateModified":"2020-02-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.mzfr.me/posts/2020-02-1-linux-priv-esc/"},"publisher":{"@type":"Organization","name":"mzfr's Blog","logo":{"@type":"ImageObject","url":"https://blog.mzfr.me/favicon.ico"}}}</script></head><body><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://blog.mzfr.me accesskey=h>mzfr's Blog</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://blog.mzfr.me/><span>Home</span></a></li><li><a href=https://blog.mzfr.me/posts/><span>Blog</span></a></li><li><a href=https://blog.mzfr.me/about/><span>About</span></a></li><li><a href=https://blog.mzfr.me/ctf/><span>CTF</span></a></li><li><a href=https://mzfr.gitbook.io/notes/><span>Notes</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Linux Privilege escalation</h1><div class=post-meta>February 1, 2020&nbsp;Â·&nbsp;5 min</div></header><div class=post-content><p>If you do all the HackTheBox, Vulnhub etc VM you will understand the feeling of getting a reverse shell on the machine but we know that you&rsquo;re far from home. Finding the right vector for escalating your privileges can be a pain in the ass. I&rsquo;m going to share some of the methods I completely depends upon for finding those vulnerable vector that helps to escalate privilege on Linux system.</p><h2 id=enumeration-scripts>Enumeration scripts<a hidden class=anchor aria-hidden=true href=#enumeration-scripts>#</a></h2><p><strong>What I use?</strong></p><p>There are lots of enumeration script that people use and they can be very helpful but can also be overwhelming at the same time. Example, <a href=https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh>LinEnum</a> I think this must be the most used enumeration script among CTF players that is because it shows all the necessary information about the system like network information, running process, binaries with capabilities etc.</p><p>I personally don&rsquo;t like to use <code>LinEnum</code> because of the following reason:</p><ol><li><p>The output is overwhelming which is can be very difficult to go through or maybe you can say I am just lazy to go through ðŸ˜œ.</p></li><li><p>It&rsquo;s too plain i.e the best thing would have been to colorize some important things.</p></li></ol><p>Those are the reason I use <a href=https://github.com/itsKindred/jalesc/>jalesc</a>, this is very similar to LinEnum but the main point of using this was because it highlights all the things that might be considered <code>important</code> like if there is some unusally SUID or if the kernel is too old that would be highlighted in the output which would be easy to checkout. And for personal use I&rsquo;ve edited out the script to only those things that are very important to me.</p><p><strong>How does enumeration script helps</strong></p><p>Enum scripts just gives you all the information at once so say if there was some binary which is set SUID you can obviously use it to escalate privileges.
So Enum scripts are the definitely the way to start your enumeration once on the system.</p><p>You can run a <code>python -m http.server</code> on your machine and then <code>wget</code> your enumeration script into the <code>/tmp</code> folder, chmod it and run it.</p><h2 id=searching-gtfobins>Searching GTFObins<a hidden class=anchor aria-hidden=true href=#searching-gtfobins>#</a></h2><p>Sometimes you find some suids or some sudo rights for specific binaries which can be used to escalate privileges easily for that you can directly search those binaries on <a href=https://gtfobins.github.io/>gtfobins</a>. If you like to search it from within your terminal you can use a tool called <a href=github.com/mzfr/gtfo>gtfo</a>. Whatever you use searching binaries on <code>gtfobins</code> is very important to easy your escalation process.</p><h3 id=sudo-rights>Sudo rights<a hidden class=anchor aria-hidden=true href=#sudo-rights>#</a></h3><p>From past few months even before running <code>enumeration scripts</code> I check for <code>sudo</code> rights of the user I am currently logged in and this is the must. To check those run</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo -l
</code></pre></div><p>The output may look like</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>User mzfr may run the following commands on mzfr:
    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /bin/nmap
</code></pre></div><p>This mean that current user <code>mzfr</code> can run <code>nmap</code> as root without password.
In lot of machines <code>sudo</code> right is the way to escalate and mostly in machines that have <code>horizontal</code> and <code>vertical</code> privilege escalation.</p><p><strong>What is horizontal and vertical privilege escalation?</strong></p><p>When you escalate from one user to another. Example, say if a machine have a user <code>mzfr</code> and you got shell as <code>www-data</code> so when you escalate privileges from <code>www-data</code> to <code>mzfr</code> that is <strong>horizontal privilege escalation</strong> and when you escalate privilege from <code>mzfr</code> to <code>root</code> thats <strong>vertical privilege escalation</strong></p><h3 id=suids>SUIDs<a hidden class=anchor aria-hidden=true href=#suids>#</a></h3><p>These are the files that have special kind of power that power is that whenever we run those files they will be executed as <code>root</code>. These files are mostly reported by <code>enumeration</code> scripts but if you want to separately search them then you can do that by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>find / -perm -u<span style=color:#f92672>=</span>s -type f 2&gt;/dev/null
</code></pre></div><h2 id=using-pspy>Using pspy<a hidden class=anchor aria-hidden=true href=#using-pspy>#</a></h2><p>Sometime when you don&rsquo;t find anything with enumeration script or as SUID you have to snoop on process running in the background that is when <a href=https://github.com/DominicBreuker/pspy/>pspy</a> comes into play.</p><p>You can just transfer the binary to the machine and then run it just by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./pspy
</code></pre></div><p>and then wait for sometime to see if it capture some running process. It&rsquo;s mostly useful to see if there is a cronjob running or if there is some kind of custom script setup.</p><h2 id=using-find-command>Using Find command<a hidden class=anchor aria-hidden=true href=#using-find-command>#</a></h2><p>Lots of time it&rsquo;s very helpful to use this command because it can help you find files or directory to which a current user have access to.</p><p>Example: Say you get a shell as <code>www-data</code> now after looking for suids, sudo rights and cron jobs you didn&rsquo;t find anything then best would be to run any of the following command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>find / -type f -user www-data 2&gt;/dev/null
</code></pre></div><p>and/or</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>find / -type d -user www-data 2&gt;/dev/null
</code></pre></div><p>These commands just find any file or directory which gives read/write access to user <code>www-data</code> and redirects all the errors to <code>/dev/null</code>.</p><p>This is helpful because you might encounter scenarios where the author of the machine wants you to read some file containing SSH keys or passwords or some other information needed to move ahead.</p><hr><p>These 3-4 steps will help you like 90% of the times obviously there are special occasions when escalating privileges can either be super hard either because the method is too CTFy (like running strings command on an image) or is way too realistic like docker sharing file/folder with root access.</p><hr><p>Thanks for reading, Feedback is always appreciated.</p><p>You can follow me on <a href=https://twitter.com/0xmzfr>@0xmzfr</a>.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2020 <a href=https://blog.mzfr.me>mzfr's Blog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><button class=top-link id=top-link type=button aria-label="go to top" title="Go to Top" accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button>
<script defer src=https://blog.mzfr.me/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};mybutton.onclick=function(){document.body.scrollTop=0;document.documentElement.scrollTop=0;window.location.hash=''}
function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>