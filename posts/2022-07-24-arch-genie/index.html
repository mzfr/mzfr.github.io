<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Genie in a bottle | mzfr's blog</title><meta name=keywords content="genie,arch,wsl"><meta name=description content="Decided to shift from Ubuntu to Arch WSL and found an amazing way to run systemd."><meta name=author content><link rel=canonical href=https://blog.mzfr.me/posts/2022-07-24-arch-genie/><link crossorigin=anonymous href=/assets/css/stylesheet.54f3f097e3adfb45cfcfe2baeca36117f520adac068afcfe70ee4cad7cb5c7cb.css integrity="sha256-VPPwl+Ot+0XPz+K67KNhF/UgrawGivz+cO5MrXy1x8s=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.mzfr.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.mzfr.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mzfr.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.mzfr.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.mzfr.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/monokai-sublime.min.css integrity="sha512-/l4iViNMhxR5MhSlak3Yw/L/7qUBifVy7MpLjeJTc8BPMRFbGplGN0xqufCDwhSdxSnVgy+e/OYsNnU75K3yyQ==" crossorigin=anonymous referrerpolicy=no-referrer><script async defer data-website-id=10e5d04b-13bb-4110-99b2-8c72f8854043 src=https://analytics.mzfr.me/umami.js></script><meta property="og:title" content="Genie in a bottle"><meta property="og:description" content="Decided to shift from Ubuntu to Arch WSL and found an amazing way to run systemd."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mzfr.me/posts/2022-07-24-arch-genie/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-01T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Genie in a bottle"><meta name=twitter:description content="Decided to shift from Ubuntu to Arch WSL and found an amazing way to run systemd."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.mzfr.me/posts/"},{"@type":"ListItem","position":3,"name":"Genie in a bottle","item":"https://blog.mzfr.me/posts/2022-07-24-arch-genie/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Genie in a bottle","name":"Genie in a bottle","description":"Decided to shift from Ubuntu to Arch WSL and found an amazing way to run systemd.","keywords":["genie, arch, wsl"],"articleBody":"I‚Äôve been using the desktop for work for the past 2 years now. Back when I built my PC I decided to give WSL a try. I had a feeling that it might not work out but with the right tooling and quite a lot of time to configure, I was able to make it work. To be able to follow all the available guides online and the official documentation I decided to stick with WSL ubuntu. Before this when I was doing everything on my old laptop I was using Manjaro.\nInitially, I thought even though I‚Äôm going with Ubuntu, I don‚Äôt see myself sticking with Windows+WSL setup and will surely shift to full Linux on the desktop. But WSL worked really well. And being on Windows meant to be able to install \u0026 play games from steam/epic games/Ubisoft/Xbox without any hassle. This setup worked so well that I even gave my OSCP exam on a Kali Linux WSL.\nFor people curious about how I did it, When I started doing labs I was using Win-Kex which is like an official application that provides Kali desktop experience on WSL. But towards the end of the labs, I started having issues with Win-Kex. For the exam, I ended up using xfce4 which actually worked better than the Win-kex.\nAnyways for a long time I‚Äôve been using WSL Ubuntu for development and Kali WSL for security-related work. But lately, I decided to shift to Arch Linux because I wasn‚Äôt able to tell people, I use Arch üòÇ. Jokes aside the main reason I‚Äôd say I did the transition was that I really like that Arch is a rolling distro it gets updates really quickly and the majority of packages are up to date. The issue with Debian/Ubuntu is that apt packages installed via apt install XYZ are usually of older versions. Now I know that there are additional ways to get those newer versions but sometimes it‚Äôs irritating to do that. Also another issue I felt with ubuntu was that some packages were only available with SNAP, I didn‚Äôt like that.\nInstallation and configuration The installation part is just super easy. Follow these steps and boom you have ArchWSL working. I use Windows terminal and wanted to run Arch directly from there so for that I added the following in my terminal settings.json\n{ \"commandline\": \"E:\\\\path\\\\to\\\\Arch.exe\", \"font\": { \"face\": \"FiraCode Nerd Font Mono\", \"size\": 16 }, \"guid\": \"{1eaed209-42ed-4393-bd4c-a50c696aab1f}\", \"hidden\": false, \"name\": \"Arch\" } And then from the GUI settings of the terminal set arch as the default. Now when I start the terminal it opens directly in the home directory of my Arch Linux Subsystem.\nWorking with genie Now the intention behind this post wasn‚Äôt to tell everyone that I use arch(Pun intended üòÅ). The main reason I decided to write this post was because of genie.\nAfter installing the new arch, I started to install all the basic stuff I need on daily basis like python3, ptpython, nvim, etc. Once that was done I started to set up my dev environment, to be specific I was making sure that the application I was working on will be able to run properly. So first I made a python virtual environment and installed all the dependencies. That project uses PostgreSQL and Redis so I installed PostgreSQL via yay and ran the following command:\nsudo service postgresql start But to my surprise I got the following error:\nsudo: service: command not found For a second I thought that I might need to install a package/library to be able to run this command. I‚Äôm aware of the fact that systemctl doesn‚Äôt run by default on WSL(if you wanna read about this a bit, see this). That is why on my old ubuntu setup I was using service command there and as far as I remember I didn‚Äôt install anything extra to be able to run that command. But now on the new Arch setup, service isn‚Äôt even a command.\nAfter some googling, I found out this comment\nI created systemctl alternative package and documented it.\nIf you use WSL2, you can use genie.\nthat‚Äôs all we can do.\nThis is a common problem with container Linux and WSL. I had never heard of genie before so I decided to give it a try.\nGenie is basically a way of running containerized systemd inside WSL, that container is known as a ‚Äúbottle‚Äù. With genie, you can run and enable any service via systemd.\nFor my setup, all I had to do was install genie via yay, create the config file and once that was done, run genie -s to get inside a bottle. Once you are inside the bottle you can run systemctl commands, normally like sudo sytstemctl start postgresql.service.\nOnce I had excess to systemctl I enabled all the services that are required by the application. That way all I have to do is run genie -s and it automatically starts all the enabled services.\nI only faced two easily solvable issues with genie.\nOne of the issues that I faced with genie is that sometimes it times out. Basically when I run genie -s it throws a warning and timeouts after 240 seconds. But the solution was also simple, just re-run the same command and that works.\nAnother issue was exactly what is mentioned here.\nI‚Äôve been using WSL Arch with the genie for systemd for almost 4 weeks now and haven‚Äôt had any other issues.\n","wordCount":"913","inLanguage":"en","datePublished":"2022-08-01T00:00:00Z","dateModified":"2022-08-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.mzfr.me/posts/2022-07-24-arch-genie/"},"publisher":{"@type":"Organization","name":"mzfr's blog","logo":{"@type":"ImageObject","url":"https://blog.mzfr.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.mzfr.me accesskey=h title="mzfr's blog (Alt + H)">mzfr's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.mzfr.me/ title=Home><span>Home</span></a></li><li><a href=https://blog.mzfr.me/about/ title=About><span>About</span></a></li><li><a href=https://wiki.mzfr.me title=Notes><span>Notes</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://blog.mzfr.me/ctf/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Genie in a bottle</h1><div class=post-meta><span title='2022-08-01 00:00:00 +0000 UTC'>August 1, 2022</span>&nbsp;¬∑&nbsp;5 min</div></header><div class=post-content><p>I&rsquo;ve been using the desktop for work for the past 2 years now. Back when I built my PC I decided to give <a href=https://docs.microsoft.com/en-us/windows/wsl/install>WSL</a> a try. I had a feeling that it might not work out but with the right tooling and quite a lot of time to configure, I was able to make it work. To be able to follow all the available guides online and the official documentation I decided to stick with WSL ubuntu. Before this when I was doing everything on my old laptop <a href=https://knowyourmeme.com/memes/btw-i-use-arch>I was using Manjaro</a>.</p><p>Initially, I thought even though I&rsquo;m going with Ubuntu, I don&rsquo;t see myself sticking with Windows+WSL setup and will surely shift to full Linux on the desktop. But WSL worked really well. And being on Windows meant to be able to install & play games from steam/epic games/Ubisoft/Xbox without any hassle. This setup worked so well that I even gave my <a href=https://www.offensive-security.com/pwk-oscp/>OSCP</a> exam on a Kali Linux WSL.</p><p>For people curious about how I did it, When I started doing labs I was using <a href=https://www.kali.org/docs/wsl/win-kex/>Win-Kex</a> which is like an official application that provides Kali desktop experience on WSL. But towards the end of the labs, I started having <a href=https://github.com/microsoft/WSL/discussions/6675>issues</a> with Win-Kex. For the exam, I ended up using <a href=https://gitlab.xfce.org/xfce>xfce4</a> which actually worked better than the Win-kex.</p><p>Anyways for a long time I&rsquo;ve been using WSL Ubuntu for development and Kali WSL for security-related work. But lately, I decided to shift to Arch Linux because I wasn&rsquo;t able to tell people, I use Arch üòÇ. Jokes aside the main reason I&rsquo;d say I did the transition was that I really like that Arch is a rolling distro it gets updates really quickly and the majority of packages are up to date. The issue with Debian/Ubuntu is that <code>apt</code> packages installed via <code>apt install XYZ</code> are usually of older versions. Now I know that there are additional ways to get those newer versions but sometimes it&rsquo;s irritating to do that. Also another issue I felt with ubuntu was that some packages were only available with <a href=https://snapcraft.io/>SNAP</a>, I didn&rsquo;t like that.</p><h2 id=installation-and-configuration>Installation and configuration<a hidden class=anchor aria-hidden=true href=#installation-and-configuration>#</a></h2><p>The installation part is just super easy. Follow <a href=https://github.com/yuk7/ArchWSL#zip>these steps</a> and boom you have ArchWSL working. I use Windows <a href=https://github.com/microsoft/terminal>terminal</a> and wanted to run Arch directly from there so for that I added the following in my terminal <code>settings.json</code></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;commandline&#34;</span>: <span style=color:#63c381>&#34;E:\\path\\to\\Arch.exe&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;font&#34;</span>:
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>&#34;face&#34;</span>: <span style=color:#63c381>&#34;FiraCode Nerd Font Mono&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e06c75>&#34;size&#34;</span>: <span style=color:#d19a66>16</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;guid&#34;</span>: <span style=color:#63c381>&#34;{1eaed209-42ed-4393-bd4c-a50c696aab1f}&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;hidden&#34;</span>: <span style=color:#b756ff;font-weight:700>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;name&#34;</span>: <span style=color:#63c381>&#34;Arch&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And then from the GUI settings of the terminal set arch as the default. Now when I start the terminal it opens directly in the home directory of my Arch Linux Subsystem.</p><h2 id=working-with-genie>Working with genie<a hidden class=anchor aria-hidden=true href=#working-with-genie>#</a></h2><p>Now the intention behind this post wasn&rsquo;t to tell everyone that I use arch(Pun intended üòÅ). The main reason I decided to write this post was because of <a href=https://github.com/arkane-systems/genie>genie</a>.</p><p>After installing the new arch, I started to install all the basic stuff I need on daily basis like python3, <a href=https://github.com/prompt-toolkit/ptpython>ptpython</a>, <a href=https://github.com/prompt-toolkit/ptpython>nvim</a>, etc. Once that was done I started to set up my dev environment, to be specific I was making sure that the application I was working on will be able to run properly. So first I made a python virtual environment and installed all the dependencies. That project uses PostgreSQL and Redis so I installed PostgreSQL via <a href=https://github.com/Jguer/yay>yay</a> and ran the following command:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo service postgresql start
</span></span></code></pre></div><p>But to my surprise I got the following error:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo: service: <span style=color:#ef8383>command</span> not found
</span></span></code></pre></div><p>For a second I thought that I might need to install a package/library to be able to run this command. I&rsquo;m aware of the fact that systemctl doesn&rsquo;t run by default on WSL(if you wanna read about this a bit, <a href=https://superuser.com/a/1719430>see this</a>). That is why on my old ubuntu setup I was using <code>service</code> command there and as far as I remember I didn&rsquo;t install anything extra to be able to run that command. But now on the new Arch setup, service isn&rsquo;t even a command.</p><p>After some googling, I found out <a href=https://github.com/yuk7/ArchWSL/issues/20#issuecomment-545245760>this comment</a></p><blockquote><p>I created systemctl alternative package and documented it.</p></blockquote><blockquote><p>If you use WSL2, you can use genie.</p></blockquote><blockquote><p>that&rsquo;s all we can do.</p></blockquote><blockquote><p>This is a common problem with container Linux and WSL.
I had never heard of genie before so I decided to give it a try.</p></blockquote><p>Genie is basically a way of running containerized systemd inside WSL, that container is known as a &ldquo;bottle&rdquo;. With genie, you can run and enable any service via systemd.</p><p>For my setup, all I had to do was install genie via yay, <a href=https://github.com/arkane-systems/genie#configuration-file>create the config file</a> and once that was done, run <code>genie -s</code> to get inside a bottle. Once you are inside the bottle you can run systemctl commands, normally like <code>sudo sytstemctl start postgresql.service</code>.</p><p>Once I had excess to <code>systemctl</code> I enabled all the services that are required by the application. That way all I have to do is run <code>genie -s</code> and it automatically starts all the enabled services.</p><p>I only faced two easily solvable issues with genie.</p><ul><li><p>One of the issues that I faced with genie is that sometimes it times out. Basically when I run <code>genie -s</code> it throws a warning and timeouts after 240 seconds. But the solution was also simple, just re-run the same command and that works.</p></li><li><p>Another issue was exactly what is mentioned <a href=https://github.com/arkane-systems/genie/wiki/Command-%22code%22-not-found-for-VScode-remote-in-bottle%3F-Here%27s-a-solution>here</a>.</p></li></ul><p>I&rsquo;ve been using WSL Arch with the genie for systemd for almost 4 weeks now and haven&rsquo;t had any other issues.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.mzfr.me/tags/genie-arch-wsl/>genie, arch, wsl</a></li></ul><nav class=paginav><a class=next href=https://blog.mzfr.me/posts/2021-12-31-year-in-review-2021/><span class=title>Next ¬ª</span><br><span>Year In Review-2021</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.mzfr.me>mzfr's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>